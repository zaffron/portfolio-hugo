<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>How to serve CNN models with Fast API | Avinash Rijal - Personal Blog &amp; Portfolio</title>

  
  <link rel="icon" href="/favicon.ico">

  
  
<meta name="title" content="How to serve CNN models with Fast API | Avinash Rijal - Personal Blog &amp; Portfolio">
<meta name="description" content="Blog about serving CNN models with Fast API">

<meta name="keywords" content="programming,python,fastapi,cnn,ml,api">

<meta name="author" content="Avinash Rijal">



<link rel="canonical" href="https://avinashrijal.com.np/posts/how-to-serve-cnn-models-with-fast-api/">




<meta name="robots" content="index, follow">



<meta property="og:type" content="article">
<meta property="og:url" content="https://avinashrijal.com.np/posts/how-to-serve-cnn-models-with-fast-api/">
<meta property="og:title" content="How to serve CNN models with Fast API">
<meta property="og:description" content="Blog about serving CNN models with Fast API">

<meta property="og:image" content="https://avinashrijal.com.np/og-default.png">

<meta property="og:site_name" content="Avinash Rijal - Personal Blog &amp; Portfolio">
<meta property="og:locale" content="en-us">



<meta property="article:published_time" content="2025-03-05T00:00:00Z">

<meta property="article:modified_time" content="2025-03-05T00:00:00Z">


<meta property="article:author" content="Avinash Rijal">



<meta property="article:section" content="Programming">

<meta property="article:section" content="Machine Learning">

<meta property="article:section" content="Tutorial">




<meta property="article:tag" content="programming">

<meta property="article:tag" content="python">

<meta property="article:tag" content="fastapi">

<meta property="article:tag" content="cnn">

<meta property="article:tag" content="ml">

<meta property="article:tag" content="api">





<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:url" content="https://avinashrijal.com.np/posts/how-to-serve-cnn-models-with-fast-api/">
<meta name="twitter:title" content="How to serve CNN models with Fast API">
<meta name="twitter:description" content="Blog about serving CNN models with Fast API">

<meta name="twitter:image" content="https://avinashrijal.com.np/og-default.png">



<meta name="twitter:site" content="@avinashrijal">
<meta name="twitter:creator" content="@avinashrijal">



  
  
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "How to serve CNN models with Fast API",
  "description": "Blog about serving CNN models with Fast API",
  
  "image": {
    "@type": "ImageObject",
    "url": "https:\/\/avinashrijal.com.np\/og-default.png"
  },
  
  "datePublished": "2025-03-05T00:00:00Z",
  
  "dateModified": "2025-03-05T00:00:00Z",
  
  "author": {
    "@type": "Person",
    "name": "Avinash Rijal",
    "url": "https:\/\/avinashrijal.com.np\/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Avinash Rijal - Personal Blog \u0026 Portfolio",
    "url": "https:\/\/avinashrijal.com.np\/",
    "logo": {
      "@type": "ImageObject",
      "url": "https:\/\/avinashrijal.com.np\/avinash-icon.png"
    }
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https:\/\/avinashrijal.com.np\/posts\/how-to-serve-cnn-models-with-fast-api\/"
  },
  "articleSection": "[\"Programming\",\"Machine Learning\",\"Tutorial\"]",
  "keywords": "[\"programming\",\"python\",\"fastapi\",\"cnn\",\"ml\",\"api\"]",
  "wordCount":  1039 
}
</script>





  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  
  <link rel="stylesheet" href="/css/main.css">
</head>
<body class="font-sans antialiased">
  <header class="fixed top-0 w-full bg-white shadow-sm z-50">
  <nav class="container mx-auto px-6 py-4">
    <div class="flex items-center justify-between">
      <a href="/" class="text-2xl font-bold text-[#6b63ff]">
        Avinash Rijal
      </a>

      
      <ul class="hidden md:flex items-center gap-8">
        
          <li>
            <a href="/" class="text-gray-700 hover:text-[#6b63ff] transition-colors font-medium">
              Home
            </a>
          </li>
        
          <li>
            <a href="/#about" class="text-gray-700 hover:text-[#6b63ff] transition-colors font-medium">
              About
            </a>
          </li>
        
          <li>
            <a href="/#skills" class="text-gray-700 hover:text-[#6b63ff] transition-colors font-medium">
              Skills
            </a>
          </li>
        
          <li>
            <a href="/#portfolio" class="text-gray-700 hover:text-[#6b63ff] transition-colors font-medium">
              Portfolio
            </a>
          </li>
        
          <li>
            <a href="/#contact" class="text-gray-700 hover:text-[#6b63ff] transition-colors font-medium">
              Contact
            </a>
          </li>
        
          <li>
            <a href="/posts/" class="text-gray-700 hover:text-[#6b63ff] transition-colors font-medium">
              Blog
            </a>
          </li>
        
      </ul>

      
      <button id="mobile-menu-button" class="md:hidden text-gray-700">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
        </svg>
      </button>
    </div>

    
    <div id="mobile-menu" class="hidden md:hidden mt-4 pb-4">
      <ul class="flex flex-col gap-4">
        
          <li>
            <a href="/" class="block text-gray-700 hover:text-[#6b63ff] transition-colors font-medium">
              Home
            </a>
          </li>
        
          <li>
            <a href="/#about" class="block text-gray-700 hover:text-[#6b63ff] transition-colors font-medium">
              About
            </a>
          </li>
        
          <li>
            <a href="/#skills" class="block text-gray-700 hover:text-[#6b63ff] transition-colors font-medium">
              Skills
            </a>
          </li>
        
          <li>
            <a href="/#portfolio" class="block text-gray-700 hover:text-[#6b63ff] transition-colors font-medium">
              Portfolio
            </a>
          </li>
        
          <li>
            <a href="/#contact" class="block text-gray-700 hover:text-[#6b63ff] transition-colors font-medium">
              Contact
            </a>
          </li>
        
          <li>
            <a href="/posts/" class="block text-gray-700 hover:text-[#6b63ff] transition-colors font-medium">
              Blog
            </a>
          </li>
        
      </ul>
    </div>
  </nav>
</header>


<div class="h-20"></div>

<script>
  document.getElementById('mobile-menu-button').addEventListener('click', function() {
    document.getElementById('mobile-menu').classList.toggle('hidden');
  });
</script>


  <main>
    
<article class="py-12 md:py-20">
  <div class="container mx-auto px-6 max-w-4xl">
    
    <nav class="mb-8 text-sm text-gray-600">
      <ol class="flex flex-wrap items-center gap-2">
        <li><a href="/" class="hover:text-[#6b63ff] transition-colors">Home</a></li>
        <li>/</li>
        <li><a href="/posts" class="hover:text-[#6b63ff] transition-colors">Blog</a></li>
        
          
            <li>/</li>
            <li><a href="/categories/programming" class="hover:text-[#6b63ff] transition-colors">Programming</a></li>
          
        
        <li>/</li>
        <li class="text-gray-400">How to serve CNN models with Fast API</li>
      </ol>
    </nav>

    
    <header class="mb-12">
      <h1 class="text-4xl md:text-5xl font-bold mb-6 text-gray-900">How to serve CNN models with Fast API</h1>

      
      <div class="flex flex-wrap items-center gap-4 text-gray-600 mb-6">
        
        
        <div class="flex items-center gap-2">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
          </svg>
          <span>Avinash Rijal</span>
        </div>
        <span>â€¢</span>
        

        
        <time datetime="2025-03-05" class="flex items-center gap-2">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
          </svg>
          March 5, 2025
        </time>

        
        <span>â€¢</span>
        <div class="flex items-center gap-2">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
          <span>5 min read</span>
        </div>

        
        
        
        
      </div>

      
      
      <div class="flex flex-wrap gap-2 mb-6">
        
          <a href="/categories/programming"
             class="px-4 py-2 bg-[#6b63ff] bg-opacity-15 text-[#6b63ff] rounded-lg font-medium hover:bg-opacity-25 transition-all">
            Programming
          </a>
        
          <a href="/categories/machine-learning"
             class="px-4 py-2 bg-[#6b63ff] bg-opacity-15 text-[#6b63ff] rounded-lg font-medium hover:bg-opacity-25 transition-all">
            Machine Learning
          </a>
        
          <a href="/categories/tutorial"
             class="px-4 py-2 bg-[#6b63ff] bg-opacity-15 text-[#6b63ff] rounded-lg font-medium hover:bg-opacity-25 transition-all">
            Tutorial
          </a>
        
      </div>
      

      
      
      <div class="flex flex-wrap gap-2 mb-6">
        
          <a href="/tags/programming"
             class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm hover:bg-gray-200 transition-colors">
            #programming
          </a>
        
          <a href="/tags/python"
             class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm hover:bg-gray-200 transition-colors">
            #python
          </a>
        
          <a href="/tags/fastapi"
             class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm hover:bg-gray-200 transition-colors">
            #fastapi
          </a>
        
          <a href="/tags/cnn"
             class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm hover:bg-gray-200 transition-colors">
            #cnn
          </a>
        
          <a href="/tags/ml"
             class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm hover:bg-gray-200 transition-colors">
            #ml
          </a>
        
          <a href="/tags/api"
             class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm hover:bg-gray-200 transition-colors">
            #api
          </a>
        
      </div>
      

      
      
        <p class="text-xl text-gray-600 leading-relaxed">Blog about serving CNN models with Fast API</p>
      
    </header>

    
    

    
    

    
    
    
    <div class="mb-12 p-6 bg-gray-50 rounded-xl border border-gray-200">
      <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
        <svg class="w-6 h-6 text-[#6b63ff]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7"/>
        </svg>
        Table of Contents
      </h2>
      <div class="toc prose prose-sm max-w-none">
        <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#so-why-fast-api">So, Why fast API?</a></li>
        <li><a href="#basically-we-will-follow-these-rules">Basically we will follow these rules</a></li>
        <li><a href="#the-code">The Code</a>
          <ul>
            <li><a href="#elaboration">Elaboration</a></li>
            <li><a href="#elaboration-1">Elaboration</a></li>
          </ul>
        </li>
        <li><a href="#i-want-to-use-docker">I want to use docker</a></li>
      </ul>
    </li>
  </ul>
</nav>
      </div>
    </div>
    
    

    
    <div class="prose prose-lg max-w-none mb-12">
      <p><img src="../assets/cnn-with-fast-api.webp" alt="cnn-with-fast-api" title="CNN with Fast API"></p>
<p>Tags: #programming, #python</p>
<p>Recently I have run into an issue with a client who asked me to build a CNN model for certain task. Let&rsquo;s keep &ldquo;why&rdquo; a secret and let&rsquo;s talk about why I am writing this blog.
The issue that we ran into later on was, my client was not ready to use the sagemaker for deploying the model even though we trained it on sagemaker. He wanted a custom repo where we could track the files and have our own custom inference.
On top of that he wanted <code>Fast API</code></p>
<h3 id="so-why-fast-api">So, Why fast API?</h3>
<p>I don&rsquo;t want to write a full page of elaboration on why fast API and why not others. To keep it simple, the client just wanted it on Fast API. His reasons being:</p>
<ul>
<li>It was easier to learn, so if in future anyone else wants to modify something they can quickly make changes</li>
<li>It was fast</li>
<li>Has satisfactory performance</li>
</ul>
<p>I am pretty sure, you already know somewhat ins and out of all the frameworks and already thinking why this guy is talking BS over showing us actual code. As a developer I think that is what would come to your mind so I will just start writing things which you came for.</p>
<h3 id="basically-we-will-follow-these-rules">Basically we will follow these rules</h3>
<ul>
<li>we will keep it simple</li>
<li>we will write as much less code as possible</li>
<li>and the code should just do the job as POC to test</li>
</ul>
<h3 id="the-code">The Code</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> tensorflow.keras.models <span style="color:#f92672">import</span> load_model
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> pickle
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> loguru <span style="color:#f92672">import</span> logger
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>logger<span style="color:#f92672">.</span>debug(<span style="color:#e6db74">&#34;Loading model...&#34;</span>)
</span></span><span style="display:flex;"><span>model <span style="color:#f92672">=</span> load_model(<span style="color:#e6db74">&#34;model-artifacts/model.keras&#34;</span>)
</span></span><span style="display:flex;"><span>logger<span style="color:#f92672">.</span>debug(<span style="color:#e6db74">&#34;Model loaded successfully!&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>logger<span style="color:#f92672">.</span>debug(<span style="color:#e6db74">&#34;Loading vectorizer...&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#34;model-artifacts/vectorizer.pkl&#34;</span>, <span style="color:#e6db74">&#34;rb&#34;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>    vectorizer <span style="color:#f92672">=</span> pickle<span style="color:#f92672">.</span>load(f)
</span></span><span style="display:flex;"><span>logger<span style="color:#f92672">.</span>debug(<span style="color:#e6db74">&#34;Vectorizer loaded successfully!&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>logger<span style="color:#f92672">.</span>debug(<span style="color:#e6db74">&#34;Loading label encoder...&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#34;model-artifacts/label_encoder.pkl&#34;</span>, <span style="color:#e6db74">&#34;rb&#34;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>    label_encoder <span style="color:#f92672">=</span> pickle<span style="color:#f92672">.</span>load(f)
</span></span><span style="display:flex;"><span>logger<span style="color:#f92672">.</span>debug(<span style="color:#e6db74">&#34;Label encoder loaded successfully!&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">preprocess_query</span>(queries):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Pre-process the queries, vectorize them and reshape for model
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    :return Returns vectors
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    query_vectors <span style="color:#f92672">=</span> vectorizer<span style="color:#f92672">.</span>transform(queries)<span style="color:#f92672">.</span>toarray()
</span></span><span style="display:flex;"><span>    query_vectors <span style="color:#f92672">=</span> query_vectors<span style="color:#f92672">.</span>reshape(
</span></span><span style="display:flex;"><span>        query_vectors<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>], query_vectors<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">1</span>], <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    )  <span style="color:#75715e"># Reshape for Conv1D</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> query_vectors
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@logger.catch</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_predictions</span>(queries):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Process the queries which are in list and return the results after inferencing the model
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    :return list of {&#39;query&#39;, &#39;category&#39;, &#39;probability&#39;} after inferencing
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    query_vectors <span style="color:#f92672">=</span> preprocess_query(queries)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    predicted_probs <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>predict(query_vectors)
</span></span><span style="display:flex;"><span>    predicted_indices <span style="color:#f92672">=</span> predicted_probs<span style="color:#f92672">.</span>argmax(axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>    max_probs <span style="color:#f92672">=</span> predicted_probs<span style="color:#f92672">.</span>max(axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>    max_probs <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>atleast_1d(max_probs)
</span></span><span style="display:flex;"><span>    predicted_category <span style="color:#f92672">=</span> label_encoder<span style="color:#f92672">.</span>inverse_transform(predicted_indices)
</span></span><span style="display:flex;"><span>    results <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;query&#34;</span>: query,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;category&#34;</span>: category,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;probability&#34;</span>: round(float(probability), <span style="color:#ae81ff">4</span>),
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> query, category, probability <span style="color:#f92672">in</span> zip(queries, predicted_category, max_probs)
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> results
</span></span></code></pre></div><p>filename: <code>inference.py</code></p>
<h4 id="elaboration">Elaboration</h4>
<p>Basically three things are happening here:</p>
<ol>
<li>We are loading all the artifacts</li>
<li>We are defining pre-processor function to process our queries</li>
<li>We are predicting and returning results</li>
</ol>
<p>We are loading the model, label_encoder and vectorizer on the first few steps. You can use pickle or joblib, it&rsquo;s up to your choice. I like pickle so I went with it.
After that our main method is <code>get_predictions</code> where we will take the queries list and then pre-process it, predict the results with the model and return the results while <code>preprocess_query</code> acts as a method which will act as a separate method just to pre-process anything on the queries list to have a separation of concern.</p>
<p>Then we have:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> uvicorn
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> fastapi <span style="color:#f92672">import</span> FastAPI
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> inference <span style="color:#f92672">import</span> get_predictions
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> loguru <span style="color:#f92672">import</span> logger
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> pydantic <span style="color:#f92672">import</span> BaseModel
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;CNN Model API&#34;</span>
</span></span><span style="display:flex;"><span>description <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;A simple API to load and predict with CNN model in fast API&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Initiate app instance</span>
</span></span><span style="display:flex;"><span>app <span style="color:#f92672">=</span> FastAPI(title<span style="color:#f92672">=</span>title, version<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;1.0&#34;</span>, description<span style="color:#f92672">=</span>description)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">IncomingData</span>(BaseModel):
</span></span><span style="display:flex;"><span>    queries: list
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Initiate logging</span>
</span></span><span style="display:flex;"><span>log_format <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{time}</span><span style="color:#e6db74"> | </span><span style="color:#e6db74">{level}</span><span style="color:#e6db74"> | </span><span style="color:#e6db74">{message}</span><span style="color:#e6db74"> | </span><span style="color:#e6db74">{file}</span><span style="color:#e6db74"> | </span><span style="color:#e6db74">{line}</span><span style="color:#e6db74"> | </span><span style="color:#e6db74">{function}</span><span style="color:#e6db74"> | </span><span style="color:#e6db74">{exception}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>logger<span style="color:#f92672">.</span>add(
</span></span><span style="display:flex;"><span>    sink<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;app/data/log_files/logs.log&#34;</span>,
</span></span><span style="display:flex;"><span>    format<span style="color:#f92672">=</span>log_format,
</span></span><span style="display:flex;"><span>    level<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;DEBUG&#34;</span>,
</span></span><span style="display:flex;"><span>    compression<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;zip&#34;</span>,
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Api root or health endpoint</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@app.get</span>(<span style="color:#e6db74">&#34;/&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@app.get</span>(<span style="color:#e6db74">&#34;/health&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">read_home</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Health endpoint which can be used to test the availability of the application.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    :return: Dict with key &#39;message&#39; and value
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    logger<span style="color:#f92672">.</span>debug(<span style="color:#e6db74">&#34;User checked the root page&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#34;message&#34;</span>: <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>title<span style="color:#e6db74">}</span><span style="color:#e6db74"> - live!&#34;</span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Prediction endpoint</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@app.post</span>(<span style="color:#e6db74">&#34;/predict&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@logger.catch</span>()  <span style="color:#75715e"># catch any unexpected breaks</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_predictions_from_model</span>(incoming_data: IncomingData):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Prediction endpoint to process the raw queries and pass them to model for inferencing and return the results
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    :return List with predicted category and props
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    data <span style="color:#f92672">=</span> incoming_data<span style="color:#f92672">.</span>model_dump()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> data[<span style="color:#e6db74">&#34;queries&#34;</span>]:
</span></span><span style="display:flex;"><span>        queries_parsed <span style="color:#f92672">=</span> data[<span style="color:#e6db74">&#34;queries&#34;</span>]
</span></span><span style="display:flex;"><span>        logger<span style="color:#f92672">.</span>info(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;User sent queries for predictions are: </span><span style="color:#e6db74">{</span>queries_parsed<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        preds <span style="color:#f92672">=</span> get_predictions(queries_parsed)
</span></span><span style="display:flex;"><span>        logger<span style="color:#f92672">.</span>debug(<span style="color:#e6db74">&#34;Predictions successfully generated for the user&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> preds
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;No queries found&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Run app with uvicorn with port and host specified. Host needed for docker port mapping</span>
</span></span><span style="display:flex;"><span>    uvicorn<span style="color:#f92672">.</span>run(app, port<span style="color:#f92672">=</span><span style="color:#ae81ff">8000</span>, host<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;0.0.0.0&#34;</span>)
</span></span></code></pre></div><p>filename: main.py</p>
<h4 id="elaboration-1">Elaboration</h4>
<p>Here is our <code>main.py</code> file, where will be using the previous inference code and handle our API requests. I am using FastAPI app and uvicorn web server to handle the requests.
Also, not to mention another advantage of fast API is out of the box documentation support.
So, we have two methods:
<code>/health</code> which we will be using to check the health of the API
<code>/predict</code> for predictions</p>
<hr>
<p>the <code>get_predictions_from_model</code> method handles the incoming request where it will take the incoming queries and pass it onto the prediction function to get the predictions
I am using <code>loguru</code> for logging but you can go for any other loggers of your choice.
This should have a minimal API for us to deploy the model. I have written few comments on the code itself so that I don&rsquo;t have to elaborate each and everything on the blog as I am not trying to write a detailed blog.</p>
<h3 id="i-want-to-use-docker">I want to use docker</h3>
<p>So, if you want to use docker? That is also covered.
Below is the dockerfile that I am using for it. I have used tensorflow image rather than python base image because it is PITA to install tensorflow via pip as it is slower than my 90 year old grandma</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Dockerfile" data-lang="Dockerfile"><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> <span style="color:#e6db74">tensorflow/tensorflow:2.17.0-gpu</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">WORKDIR</span> <span style="color:#e6db74">/app</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">RUN</span> apt-get update <span style="color:#f92672">&amp;&amp;</span> apt-get install -y <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>  git <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>  wget <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>  unzip <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>  <span style="color:#f92672">&amp;&amp;</span> rm -rf /var/lib/apt/lists/*<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">RUN</span> pip install --upgrade pip<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">COPY</span> requirements.txt .<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">RUN</span> pip install --no-cache-dir -r requirements.txt<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">COPY</span> . .<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">RUN</span> mkdir -p app/data/log_files <span style="color:#f92672">&amp;&amp;</span> touch app/data/log_files/logs.logs<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">RUN</span> mkdir -p app/model-artifacts<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">EXPOSE</span> <span style="color:#e6db74">8000</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">CMD</span> [<span style="color:#e6db74">&#34;python&#34;</span>, <span style="color:#e6db74">&#34;main.py&#34;</span>]<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>Don&rsquo;t forget to write all the required packages you need on the <code>requirements.txt</code> file before you proceed. You don&rsquo;t need to worry about anything else.</p>
<p>Other than that, if you want to find the full repo, you can checkout the repo on:</p>
<p><a href="https://github.com/zaffron/cnn-fastapi">CNN - FastAPI repo</a></p>
<p>Have fun!</p>

    </div>

    
    
    
    <div class="mt-16 pt-12 border-t border-gray-200">
      <h2 class="text-3xl font-bold mb-8 flex items-center gap-3">
        <svg class="w-8 h-8 text-[#6b63ff]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
        </svg>
        Related Posts
      </h2>
      <div class="grid md:grid-cols-3 gap-6">
        
        <article class="bg-white rounded-xl shadow-md hover:shadow-xl transition-shadow p-6">
          
          <h3 class="text-xl font-bold mb-2">
            <a href="/posts/from-clicks-to-keystrokes-my-journey-into-the-vim-cult/" class="text-gray-900 hover:text-[#6b63ff] transition-colors">
              From Clicks to Keystrokes: My Journey into the Vim CultðŸš€ðŸ”¥
            </a>
          </h3>
          <p class="text-gray-600 text-sm mb-4"><p>Back in the days, it was somewhere around when I first started my developer career, I was a Sublime â€¦</p></p>
          <div class="flex items-center justify-between text-sm text-gray-500">
            <time datetime="2025-03-14">
              Mar 14, 2025
            </time>
            <span>8 min</span>
          </div>
        </article>
        
        <article class="bg-white rounded-xl shadow-md hover:shadow-xl transition-shadow p-6">
          
          <h3 class="text-xl font-bold mb-2">
            <a href="/posts/serve-home-server-with-true-fib/" class="text-gray-900 hover:text-[#6b63ff] transition-colors">
              Serving Your Home Server with True Fiber Internet Without a Static IP
            </a>
          </h3>
          <p class="text-gray-600 text-sm mb-4"><h3 id="problem-description">Problem Description</h3>
<p>Recently, I switched to a new internet service provider in Thailand called â€¦</p></p>
          <div class="flex items-center justify-between text-sm text-gray-500">
            <time datetime="2023-01-15">
              Jan 15, 2023
            </time>
            <span>3 min</span>
          </div>
        </article>
        
        <article class="bg-white rounded-xl shadow-md hover:shadow-xl transition-shadow p-6">
          
          <div class="mb-4 rounded-lg overflow-hidden">
            <img src="/uploads/editor-setup-hiboo.png"
                 alt="My Editor Setup While Working for Hiboo"
                 class="w-full h-40 object-cover">
          </div>
          
          <h3 class="text-xl font-bold mb-2">
            <a href="/posts/editor-setup-hiboo/" class="text-gray-900 hover:text-[#6b63ff] transition-colors">
              My Editor Setup While Working for Hiboo
            </a>
          </h3>
          <p class="text-gray-600 text-sm mb-4"><p>I use <strong>VSCode</strong>. It&rsquo;s free, simple and runs smoothly on all platforms.</p>
<p>Let&rsquo;s talk about â€¦</p></p>
          <div class="flex items-center justify-between text-sm text-gray-500">
            <time datetime="2023-01-15">
              Jan 15, 2023
            </time>
            <span>2 min</span>
          </div>
        </article>
        
      </div>
    </div>
    

    
    <div class="mt-12 pt-8 border-t border-gray-200">
      <a href="/posts"
         class="inline-flex items-center gap-2 text-[#6b63ff] hover:gap-3 transition-all font-medium">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 17l-5-5m0 0l5-5m-5 5h12"/>
        </svg>
        Back to Blog
      </a>
    </div>
  </div>
</article>

<style>
  .toc ul {
    list-style-type: disc;
    padding-left: 1.5rem;
  }
  .toc a {
    color: #6b63ff;
    text-decoration: none;
  }
  .toc a:hover {
    text-decoration: underline;
  }
</style>

  </main>

  <footer class="bg-gray-900 text-white py-12">
  <div class="container mx-auto px-6">
    <div class="grid md:grid-cols-3 gap-8">
      <div>
        <h3 class="text-2xl font-bold mb-4">Avinash Rijal</h3>
        <p class="text-gray-400">Hi! I am Avinash Rijal. A Full stack web developer and DevOps Engineer from Nepal.</p>
      </div>

      <div>
        <h4 class="text-lg font-semibold mb-4">Quick Links</h4>
        <ul class="space-y-2">
          
            <li>
              <a href="/" class="text-gray-400 hover:text-white transition-colors">
                Home
              </a>
            </li>
          
            <li>
              <a href="/#about" class="text-gray-400 hover:text-white transition-colors">
                About
              </a>
            </li>
          
            <li>
              <a href="/#skills" class="text-gray-400 hover:text-white transition-colors">
                Skills
              </a>
            </li>
          
            <li>
              <a href="/#portfolio" class="text-gray-400 hover:text-white transition-colors">
                Portfolio
              </a>
            </li>
          
            <li>
              <a href="/#contact" class="text-gray-400 hover:text-white transition-colors">
                Contact
              </a>
            </li>
          
            <li>
              <a href="/posts/" class="text-gray-400 hover:text-white transition-colors">
                Blog
              </a>
            </li>
          
        </ul>
      </div>

      <div>
        <h4 class="text-lg font-semibold mb-4">Connect</h4>
        <div class="flex gap-4">
          <a href="https://linkedin.com/in/dev-avinash-rijal/" target="_blank" rel="noopener"
             class="w-10 h-10 bg-gray-800 rounded-lg flex items-center justify-center hover:bg-[#6b63ff] transition-colors">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/></svg>
          </a>
          <a href="https://github.com/zaffron" target="_blank" rel="noopener"
             class="w-10 h-10 bg-gray-800 rounded-lg flex items-center justify-center hover:bg-[#6b63ff] transition-colors">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
          </a>
          <a href="http://twitter.com/avinashrijal" target="_blank" rel="noopener"
             class="w-10 h-10 bg-gray-800 rounded-lg flex items-center justify-center hover:bg-[#6b63ff] transition-colors">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z"/></svg>
          </a>
        </div>
      </div>
    </div>

    <div class="border-t border-gray-800 mt-8 pt-8 text-center text-gray-400">
      <p>&copy; 2025 Avinash Rijal. All rights reserved.</p>
    </div>
  </div>
</footer>

</body>
</html>
