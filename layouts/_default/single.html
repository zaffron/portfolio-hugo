{{ define "main" }}
  <article class="py-12 md:py-20">
    <div class="container mx-auto px-6 max-w-4xl">
      <!-- Breadcrumbs -->
      <nav class="mb-8 text-sm text-gray-600 dark:text-gray-400">
        <ol class="flex flex-wrap items-center gap-2">
          <li>
            <a href="/" class="hover:text-[#6b63ff] transition-colors">Home</a>
          </li>
          <li>/</li>
          <li>
            <a href="/posts" class="hover:text-[#6b63ff] transition-colors"
              >Blog</a
            >
          </li>
          {{ if .Params.categories }}
            {{ range first 1 .Params.categories }}
              <li>/</li>
              <li>
                <a
                  href="/categories/{{ . | urlize }}"
                  class="hover:text-[#6b63ff] transition-colors"
                  >{{ . }}</a
                >
              </li>
            {{ end }}
          {{ end }}
          <li>/</li>
          <li class="text-gray-400 dark:text-gray-500">{{ .Title }}</li>
        </ol>
      </nav>

      <!-- Article Header -->
      <header class="mb-12">
        <h1
          class="text-4xl md:text-5xl font-bold mb-6 text-gray-900 dark:text-gray-100"
        >
          {{ .Title }}
        </h1>

        <!-- Meta Information -->
        <div
          class="flex flex-wrap items-center gap-4 text-gray-600 dark:text-gray-400 mb-6"
        >
          <!-- Author -->
          {{ if .Params.author }}
            <div class="flex items-center gap-2">
              <svg
                class="w-5 h-5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
                />
              </svg>
              <span>{{ .Params.author }}</span>
            </div>
            <span>•</span>
          {{ end }}


          <!-- Date -->
          <time
            datetime="{{ .Date.Format "2006-01-02" }}"
            class="flex items-center gap-2"
          >
            <svg
              class="w-5 h-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
              />
            </svg>
            {{ .Date.Format "January 2, 2006" }}
          </time>

          <!-- Reading Time -->
          <span>•</span>
          <div class="flex items-center gap-2">
            <svg
              class="w-5 h-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
              />
            </svg>
            <span>{{ .ReadingTime }} min read</span>
          </div>

          <!-- Last Modified -->
          {{ if .Lastmod }}
            {{ if ne (.Date.Format "2006-01-02") (.Lastmod.Format "2006-01-02") }}
              <span>•</span>
              <div class="flex items-center gap-2 text-sm">
                <svg
                  class="w-4 h-4"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
                  />
                </svg>
                <span>Updated {{ .Lastmod.Format "Jan 2, 2006" }}</span>
              </div>
            {{ end }}
          {{ end }}
        </div>

        <!-- Categories (larger badges) -->
        {{ if .Params.categories }}
          <div class="flex flex-wrap gap-2 mb-6">
            {{ range .Params.categories }}
              <a
                href="/categories/{{ . | urlize }}"
                class="px-4 py-2 bg-[#6b63ff] bg-opacity-15 text-[#6b63ff] rounded-lg font-medium hover:bg-opacity-25 transition-all"
              >
                {{ . }}
              </a>
            {{ end }}
          </div>
        {{ end }}


        <!-- Tags (smaller badges) -->
        {{ if .Params.tags }}
          <div class="flex flex-wrap gap-2 mb-6">
            {{ range .Params.tags }}
              <a
                href="/tags/{{ . | urlize }}"
                class="px-3 py-1 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 rounded-full text-sm hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors"
              >
                #{{ . }}
              </a>
            {{ end }}
          </div>
        {{ end }}


        <!-- Description -->
        {{ if .Description }}
          <p class="text-xl text-gray-600 dark:text-gray-400 leading-relaxed">
            {{ .Description }}
          </p>
        {{ end }}
      </header>

      <!-- Featured Image -->
      {{ if .Params.featured_image }}
        <div
          class="mb-12 rounded-xl overflow-hidden shadow-lg dark:shadow-gray-900/50"
        >
          <img
            src="{{ .Params.featured_image }}"
            alt="{{ if .Params.featured_image_alt }}
              {{ .Params.featured_image_alt }}
            {{ else }}
              {{ .Title }}
            {{ end }}"
            class="w-full h-auto"
          />
        </div>
      {{ end }}


      <!-- Series Navigation -->
      {{ if .Params.series }}
        <div
          class="mb-8 p-6 bg-blue-50 dark:bg-blue-900/20 border-l-4 border-blue-500 dark:border-blue-400 rounded-r-lg"
        >
          <div class="flex items-start gap-3">
            <svg
              class="w-6 h-6 text-blue-500 dark:text-blue-400 flex-shrink-0 mt-1"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"
              />
            </svg>
            <div>
              <h3 class="font-semibold text-blue-900 dark:text-blue-200 mb-2">
                Part of the "{{ .Params.series }}" series
              </h3>
              {{ $currentPage := . }}
              {{ $series := .Params.series }}
              {{ $seriesPosts := where .Site.RegularPages "Params.series" $series }}
              {{ $seriesPosts := $seriesPosts.ByParam "series_order" }}
              {{ if gt (len $seriesPosts) 1 }}
                <ol class="space-y-1 text-sm">
                  {{ range $index, $post := $seriesPosts }}
                    <li
                      class="{{ if eq $post.Permalink $currentPage.Permalink }}
                        font-semibold text-blue-700 dark:text-blue-300
                      {{ else }}
                        text-blue-600 dark:text-blue-400
                      {{ end }}"
                    >
                      {{ if eq $post.Permalink $currentPage.Permalink }}
                        {{ add $index 1 }}. {{ $post.Title }} (Current)
                      {{ else }}
                        <a href="{{ $post.Permalink }}" class="hover:underline"
                          >{{ add $index 1 }}. {{ $post.Title }}</a
                        >
                      {{ end }}
                    </li>
                  {{ end }}
                </ol>
              {{ end }}
            </div>
          </div>
        </div>
      {{ end }}


      <!-- Table of Contents -->
      {{ if and (.Params.advanced.toc | default true) (gt .WordCount 500) }}
        {{ if .TableOfContents }}
          <div
            class="mb-12 p-6 bg-gray-50 dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700"
          >
            <h2
              class="text-xl font-bold mb-4 flex items-center gap-2 text-gray-900 dark:text-gray-100"
            >
              <svg
                class="w-6 h-6 text-[#6b63ff]"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M4 6h16M4 12h16M4 18h7"
                />
              </svg>
              Table of Contents
            </h2>
            <div class="toc prose prose-sm dark:prose-invert max-w-none">
              {{ .TableOfContents }}
            </div>
          </div>
        {{ end }}
      {{ end }}


      <!-- Article Content -->
      <div
        class="prose prose-lg dark:prose-invert text-gray-700 dark:text-gray-400 max-w-none mb-12"
      >
        {{ .Content }}
      </div>

      <!-- Related Posts -->
      {{ $related := .Site.RegularPages.Related . | first 3 }}
      {{ if $related }}
        <div class="mt-16 pt-12 border-t border-gray-200 dark:border-gray-700">
          <h2
            class="text-3xl font-bold mb-8 flex items-center gap-3 text-gray-900 dark:text-gray-100"
          >
            <svg
              class="w-8 h-8 text-[#6b63ff]"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M13 10V3L4 14h7v7l9-11h-7z"
              />
            </svg>
            Related Posts
          </h2>
          <div class="grid md:grid-cols-3 gap-6">
            {{ range $related }}
              <article
                class="bg-white dark:bg-gray-800 rounded-xl shadow-md dark:shadow-gray-900/50 hover:shadow-xl dark:hover:shadow-gray-900/70 transition-shadow p-6 border border-gray-200 dark:border-gray-700"
              >
                {{ if .Params.featured_image }}
                  <div class="mb-4 rounded-lg overflow-hidden">
                    <img
                      src="{{ .Params.featured_image }}"
                      alt="{{ .Title }}"
                      class="w-full h-40 object-cover"
                    />
                  </div>
                {{ end }}
                <h3 class="text-xl font-bold mb-2">
                  <a
                    href="{{ .RelPermalink }}"
                    class="text-gray-900 dark:text-gray-100 hover:text-[#6b63ff] transition-colors"
                  >
                    {{ .Title }}
                  </a>
                </h3>
                <p class="text-gray-600 dark:text-gray-400 text-sm mb-4">
                  {{ .Summary | truncate 200 | plainify }}
                </p>
                <div
                  class="flex items-center justify-between text-sm text-gray-500 dark:text-gray-500"
                >
                  <time datetime="{{ .Date.Format "2006-01-02" }}">
                    {{ .Date.Format "Jan 2, 2006" }}
                  </time>
                  <span>{{ .ReadingTime }} min</span>
                </div>
              </article>
            {{ end }}
          </div>
        </div>
      {{ end }}


      <!-- Back to Blog -->
      <div class="mt-12 pt-8 border-t border-gray-200 dark:border-gray-700">
        <a
          href="/posts"
          class="inline-flex items-center gap-2 text-[#6b63ff] hover:gap-3 transition-all font-medium"
        >
          <svg
            class="w-5 h-5"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M11 17l-5-5m0 0l5-5m-5 5h12"
            />
          </svg>
          Back to Blog
        </a>
      </div>
    </div>
  </article>

  <style>
    .toc ul {
      list-style-type: disc;
      padding-left: 1.5rem;
    }
    .toc a {
      color: #6b63ff;
      text-decoration: none;
    }
    .toc a:hover {
      text-decoration: underline;
    }
  </style>
{{ end }}
